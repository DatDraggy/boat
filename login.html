<?php
require_once(__DIR__ . '/files/session.php');
require_once (__DIR__.'/files/config.php');
if(isset($_SESSION['userid'])){
    //Select From DB, if reg is valid, if not destroy session
    /*
    if(valid){
        header('Location: userarea.html');
    }
    else{
        //display login
    }
    */
}
if(isset($_POST['id']) && isset($_POST['password'])) {
    $dbConnection = buildDatabaseConnection($config);

    $sql = "SELECT hash, id, rank FROM users WHERE id = $userId";
    $stmt = $dbConnection->prepare('SELECT hash, id, rank FROM users WHERE id = :id');
    $stmt->bindParam(':id', $userId);
    $stmt->execute();
    $row = $stmt->fetch();
    if ($row->numRows() === 1) {
        $dbHash = $row['hash'];
        $userId = $row['id'];
        $rank = $row['rank'];
        if (password_verify($_POST['password'], $dbHash)) {
            //Logged in
            $_SESSION['userid'] = $userId;
            $_SESSION['rank'] = $rank;
            header('Location: userarea.html?text=login');
            die();
        } else {
            echo 'Login Details didn\'t match';
            //ToDo: use session to save status and msg
        }
    }
}
else{
    echo 'Missing details';
}

?>