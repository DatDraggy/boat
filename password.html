<?php
require_once('backend/config.php');
require_once('backend/funcs.php');
require_once('backend/includes.php');
if (!empty($_GET['token'])) {
  $token = $_GET['token'];
  $dbConnection = buildDatabaseConnection($config);
  $userId = getIdFromToken($token);
  if ($userId !== false) {
  } else {
    $status = 'Invalid token provided.';
    session_start();
    $_SESSION['status'] = $status;
    session_commit();
    header('Location: login');
    die();
  }
} else {
  $status = 'No Token was provided in the URL.';
  session_start();
  $_SESSION['status'] = $status;
  session_commit();
  header('Location: login');
  die($status);
}
?>
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <title>Hot Summer Nights: Furry Summerbo.at Party</title>
  <?php echo $head; ?>
</head>
<body class="hasNav">
<div id="app">
  <?php echo $nav; ?>

  <section id="contentPage" class="noHeader wrapper wrapperCentered">
    <section>
      <div class="row">
        <div class="content">
          <p><img alt="Summerboat Main Image Banner" style="margin: 0 auto" src="images/main@2x.png" width="320"></p>
        </div>
      </div>
    </section>
    <section id="registration-form">
      <div class="row">
        <div class="content">
          <h3>Login</h3>
          <form class="formWrapper" id="login" action="backend/change_password.php" method="post">
            <input type="text" value="<?php echo $token; ?>" hidden>
            <div class="inputWrapper">
              <label for="password"><span>New Password</span></label>
              <input name="password" type="password" id="password" class="input" placeholder="Enter your new password"
                     required/>
            </div>
            <div class="formRow">
              <div class="inputWrapper">
                <label for="passwordVerify"><span>Confirm new Password</span></label>
                <input name="passwordVerify" type="password" id="passwordVerify" class="input" placeholder="Confirm your new password"
                       required/>
              </div>
            </div>
            <div class="formRow">
              <button class="button buttonPrimary">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </section> <!--pageWrapper -->
  <?php echo $footer; ?>
</body>
</html>
