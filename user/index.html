<?php
require_once('../backend/config.php');
require_once('../backend/funcs.php');
require_once('../backend/includes.php');
session_start();
if (empty($_SESSION['userId'])) {
  session_commit();
  header('Location: ../login');
  die();
}
$userId = $_SESSION['userId'];
session_commit();
$dbConnection = buildDatabaseConnection($config);

////////////////////////
// Check Reg Validity //
if (!checkRegValid($userId)) {
//If invalid, kill that bih
  if (isset($_COOKIE[session_name()])) {
    setcookie(session_name(), '', time() - 3600, '/');
  }
  session_destroy();
  header('Location: ../login.html');
  die();
}
// Check Reg Validity //
////////////////////////

$userStatus = $status[getRegDetails($userId, 'nickname, status')['status']];

$payments = getPaymentDetails($userId, 'date, amount');
$paymentsHtml = '<table><th>Date</th><th>Amount</th>';
$nickname = $details['nickname'];
foreach ($payments as $payment) {
  $amount = $payment['amount'];
  $date = date('Y-m-d', $payment['date']);

  $paymentsHtml .= '<tr><td class="date">' . $date . '</td> <td class="amount">' . $amount . 'â‚¬</td></tr>';
}
$paymentsHtml .= '</table>';

?>

<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <title>Hot Summer Nights: Furry Summerbo.at Party</title>
    <?php echo $head; ?>
  </head>
  <body class="hasNav">
    <div id="app">
      <?php echo $nav; ?>

      <section id="contentPage">
		<!-- ========== Info text ========== -->

        <section id="about" class="ribbon" style="background-color: var(--colorPink)">
          <div class="wrapper">
            <div class="row">
              <div style="color:white" class="content wsLarge">
                <h1>User Area</h1>
                <p class="textBig">Welcome <?php echo $nickname; ?>. This is your own user area with all information regarding your registration for the next party. On this page are your payment transactions. Your payment status is also visible below.</p>
				<p>If you want to edit the rest of your details, please click on the button below to go to that website.</p>
				<div class="buttonGroup">
                  <a class="button buttonUpgrade" href="details" title="Edit Details">Edit Details</a>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="wrapper wsLarge">
        <div class="row">
        <h1>Payments</h1>
		</div>
		<div class="row">
		<p>Your current payment status is <strong><?php echo $userStatus; ?></strong>. Below you can find all the payments you made to us and the amount connected to it.</p>
		</div>
		<div class="row">
		<?php echo $paymentsHtml; ?>
        </div>

        </section>
      </section> <!--pageWrapper -->
      <?php echo $footer; ?>
  </body>
</html>